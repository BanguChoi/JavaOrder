package com.javaOrder.cart.repository;

import com.javaOrder.cart.domain.Cart;

import jakarta.persistence.EntityManager;
import jakarta.persistence.PersistenceContext;

public class CustomCartRepositoryImpl implements CustomCartRepository {

	@PersistenceContext
	private EntityManager entityManager;
	
	@Override
	public Cart saveWithFeneratedId(Cart cart) {
		// 장바구니ID가 없으면 생성
		if(cart.getCartId() == null) {
			String mCode = cart.getMCode();
			String cartId = generateCartId(mCode);
			cart.setCartId(cartId);
		}
		
		// 기본 save메서드 호출
		entityManager.persist(cart);
		return cart;
	}

	// 장바구니 ID 생성 로직
	private String generateCartId(String mCode) {
		return "C" + mCode;
		// 회원은 이런식으로
//		Long sequenceValue = ((Number) entityManager
//				.createNativeQuery("SELECT cart_seq.NEXTVAL FROM DUAL")
//				.getSingleResult())
//				.longValue();
//		return "M" + String.format("%04d", sequenceValue);
	}
}
